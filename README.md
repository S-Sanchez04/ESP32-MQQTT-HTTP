Chucho Control + Sensor Ultrasonido HC-SR04Este proyecto implementa un sistema basado en ESP32 que permite controlar un veh铆culo rob贸tico mediante peticiones HTTP, publicar comandos y telemetr铆a a un broker MQTT (AWS IoT Core), y medir distancias utilizando un sensor ultras贸nico HC-SR04. IntegrantesEsteban BernalNicol谩s AlmonacidSantiago S谩nchez ObjetivosAPI HTTP: Exponer endpoints /api/v1/* para recibir instrucciones de movimiento y verificar el estado del sistema (healthcheck).Puente MQTT: Publicar cada instrucci贸n recibida v铆a HTTP en el t贸pico carroESP32/instrucciones.Telemetr铆a: Medir la distancia con el sensor HC-SR04 y reportarla peri贸dicamente en el t贸pico carroESP32/sensor/hcsr04.Configuraci贸n Modular: Mantener la configuraci贸n organizada mediante variables de preprocesador (#define) en config.h. Arquitectura GeneralESP32:Act煤a como cliente WiFi (Station Mode).Levanta un servidor HTTP en el puerto 80.Se conecta a AWS IoT Core usando TLS (WiFiClientSecure + certificados en certificates.h).API HTTP (On-board): Controla los motores del carro (/move, /stop) y el estado (/health).MQTT (AWS IoT):Publica las instrucciones procesadas en carroESP32/instrucciones.Publica mediciones del ultrasonido en carroESP32/sensor/hcsr04.Diagrama de SecuenciaEl flujo detallado se encuentra en la carpeta de documentaci贸n:C贸digo Mermaid: docs/diagrama_secuencia.mdImagen: docs/diagrama_secuencia.pngFlujo Principal:Cliente HTTP (Postman/App) env铆a POST /api/v1/move.ESP32 valida par谩metros, activa motores y publica el evento en MQTT.Suscriptor MQTT (Backend/Script) recibe la notificaci贸n del comando.ESP32 (Paralelo) lee el sensor HC-SR04 y publica la distancia peri贸dicamente. Endpoints APIBase URL: /api/v1CORS: Todos los endpoints incluyen headers CORS y soportan el m茅todo OPTIONS.1. Mover el CarroInicia el movimiento de los motores seg煤n los par谩metros indicados.Endpoint: POST /api/v1/movePar谩metros (Query String o x-www-form-urlencoded):Par谩metroTipoDescripci贸nValores / RangodirectionStringDirecci贸n del movimientoforward, backward, left, rightspeedIntPotencia del motor (PWM)0 - 255durationIntTiempo de ejecuci贸n en ms0 - 5000Respuestas:200 OK: Movimiento iniciado correctamente.400 Bad Request: Faltan par谩metros o direcci贸n inv谩lida.Ejemplo de llamada:HTTPPOST http://<ip-esp32>/api/v1/move?direction=forward&speed=180&duration=1500
2. Detener el CarroDetiene inmediatamente los motores y env铆a el evento de parada a MQTT.Endpoint: POST /api/v1/stopPar谩metros: Ninguno.Respuesta: 200 OK ("Stopped + sent to AWS").3. HealthcheckVerifica si el dispositivo est谩 en l铆nea y respondiendo.Endpoint: GET /api/v1/healthRespuesta:JSON{
  "status": "ok"
}
 Interacci贸n MQTTLos t贸picos est谩n definidos en config.h. El ESP32 act煤a principalmente como publicador.1. Reporte de InstruccionesCada vez que se llama a /move o /stop, el ESP32 publica la acci贸n realizada.T贸pico: carroESP32/instruccionesPayload (Ejemplo Move):JSON{
  "direction": "forward",
  "speed": 180,
  "duration": 1500,
  "source": "http"
}
Payload (Ejemplo Stop):JSON{
  "direction": "stop",
  "speed": 0,
  "duration": 0,
  "source": "http"
}
2. Sensor Ultras贸nico (HC-SR04)ShutterstockExplorarTarea peri贸dica que reporta la distancia medida frente al veh铆culo.T贸pico: carroESP32/sensor/hcsr04Payload:JSON{
  "device": "esp32-chucho",
  "distance_cm": 25.3,
  "ts": 12345
}
 Librer铆as UtilizadasEl proyecto hace uso de las siguientes librer铆as en main.ino:WiFi.h: Gesti贸n de conexi贸n WiFi (Core ESP32).WebServer.h: Servidor HTTP ligero.WiFiClientSecure.h: Cliente con soporte TLS (necesario para AWS IoT).PubSubClient.h: Cliente MQTT ligero.Archivos locales:config.h: Constantes de configuraci贸n (Pines, WiFi, MQTT).certificates.h: Certificados CA, Cliente y Llave Privada.锔 Limitaciones ActualesSeguridad HTTP: Los endpoints no tienen autenticaci贸n y el tr谩fico viaja en texto plano (HTTP).Bloqueo: La reconexi贸n a WiFi/MQTT usa bucles con delay(), lo que puede bloquear el flujo principal moment谩neamente.Movimiento: La velocidad (0-255) no est谩 calibrada a unidades f铆sicas (m/s).L贸gica del Sensor: El HC-SR04 reporta datos pero no detiene el carro autom谩ticamente ante obst谩culos.Actualizaciones: No soporta OTA; requiere conexi贸n USB para reprogramar. Posibilidades de Mejora (Roadmap)[ ] Implementar Suscripci贸n MQTT para control remoto desde la nube.[ ] A帽adir autenticaci贸n (API Key) y HTTPS en el servidor web.[ ] Frenado de emergencia local basado en la lectura del HC-SR04.[ ] Interfaz web embebida (HTML/JS) servida directamente desde el ESP32.[ ] Portal de configuraci贸n (WiFi Manager) para evitar recompilar al cambiar de red.[ ] Refactorizaci贸n a una arquitectura de clases (C++) para separar Hardware, Red y API. Uso de MemoriaValores aproximados tras la compilaci贸n en Arduino IDE / PlatformIO:PlaintextUso de memoria de programa (Flash):  xxx.xxx bytes (YY% de la memoria disponible).
Uso de memoria din谩mica (RAM):       yyy.yyy bytes (ZZ% de la memoria disponible).
(Reemplazar con los valores reales al compilar)И C贸mo Probar el SistemaHardware: Conectar el ESP32 v铆a USB.Monitor Serie: Abrir a 115200 baudios. Verificar conexi贸n a WiFi y AWS IoT.Healthcheck:Navegador: http://<ip-esp32>/api/v1/health -> {"status":"ok"}Prueba de Movimiento (Postman/cURL):Bashcurl -X POST "http://<ip-esp32>/api/v1/move?direction=forward&speed=200&duration=1000"
Verificar MQTT:Usar un cliente como MQTTX suscrito a carroESP32/#.Confirmar recepci贸n del JSON de instrucci贸n y lecturas del sensor.
